@model dynamic
@{
    ViewData["Title"] = "Detalles de la Oferta";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Styles {
    <style>
        body {
            background-color: #F4F6F9;
            font-family: 'Segoe UI', Arial, sans-serif;
            color: #333;
        }

        .offer-section {
            padding: 3rem 2rem;
            background-color: #FFFFFF;
            border-radius: 15px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
            max-width: 800px;
            margin: 2rem auto;
        }

            .offer-section h2 {
                color: #1E3A8A;
                font-weight: 700;
                margin-bottom: 1.5rem;
                font-size: 2rem;
            }

            .offer-section p {
                color: #6B7280;
                font-size: 1rem;
                margin: 0.5rem 0;
                line-height: 1.6;
            }

                .offer-section p strong {
                    color: #374151;
                }

            .offer-section .btn-apply {
                background-color: #F97316;
                border: none;
                color: #FFFFFF;
                padding: 0.8rem 2rem;
                font-weight: 600;
                border-radius: 8px;
                font-size: 1rem;
                transition: background-color 0.3s ease, transform 0.2s ease;
                margin-top: 1.5rem;
            }

                .offer-section .btn-apply:hover {
                    background-color: #E86100;
                    transform: translateY(-2px);
                }

                .offer-section .btn-apply:disabled {
                    background-color: #6B7280;
                    cursor: not-allowed;
                }

            .offer-section .schedule-table {
                width: 100%;
                margin-top: 1rem;
                border-collapse: collapse;
            }

                .offer-section .schedule-table th,
                .offer-section .schedule-table td {
                    padding: 0.75rem;
                    text-align: left;
                    border-bottom: 1px solid #E5E7EB;
                }

                .offer-section .schedule-table th {
                    background-color: #F9FAFB;
                    color: #374151;
                    font-weight: 600;
                }

        .alert {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 8px;
        }

        .alert-success {
            background-color: #D1FAE5;
            color: #065F46;
        }

        .alert-danger {
            background-color: #FEE2E2;
            color: #991B1B;
        }
    </style>
}

<section class="offer-section">
    <h2>@ViewBag.Oferta.Titulo</h2>
    <p><strong>Empresa:</strong> @ViewBag.Oferta.Nombre_Empresa</p>
    <p><strong>Ubicación:</strong> @ViewBag.Oferta.Ubi_Pro, @ViewBag.Oferta.Ubi_Pais</p>
    <p><strong>Salario:</strong> $@ViewBag.Oferta.Salario</p>
    <p><strong>Vacantes:</strong> @ViewBag.Oferta.Vacantes</p>
    <p><strong>Duración del Contrato:</strong> @ViewBag.Oferta.Duracion_Contrato</p>
    <p><strong>Fecha de Publicación:</strong> @ViewBag.Oferta.Fecha_Publicacion.ToString("dd/MM/yyyy")</p>
    <p><strong>Descripción:</strong> @ViewBag.Oferta.Descripcion</p>

    <h3>Requisitos</h3>
    <ul>
        @foreach (var requisito in ViewBag.Requisitos)
        {
            <li>@requisito</li>
        }
    </ul>

    <h3>Horario</h3>
    <table class="schedule-table">
        <thead>
            <tr>
                <th>Día</th>
                <th>Horario 1</th>
                <th>Horario 2</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var horario in ViewBag.Horario)
            {
                <tr>
                    <td>@horario["Dia"]</td>
                    <td>@horario["Horario1"]</td>
                    <td>@horario["Horario2"]</td>
                </tr>
            }
        </tbody>
    </table>

    <div id="alertContainer"></div>

    @if (ViewBag.HasApplied)
    {
        <button class="btn-apply" disabled>Ya te has postulado</button>
    }
    else
    {
        <button class="btn-apply" onclick="postularse(@ViewBag.Oferta.Id)">Postularse</button>
    }
</section>

@section Scripts {
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
        function postularse(id_ofertaempleo) {
            $.ajax({
                url: '/OfertaEmpleoPostulante/PostularseOferta',
                type: 'POST',
                data: { id_ofertaempleo: id_ofertaempleo },
                success: function (response) {
                    var alertClass = response.success ? 'alert-success' : 'alert-danger';
                    $('#alertContainer').html(`<div class="alert ${alertClass}">${response.message}</div>`);
                    if (response.success) {
                        $('.btn-apply').prop('disabled', true).text('Ya te has postulado');
                    }
                    setTimeout(() => $('#alertContainer').empty(), 5000);
                },
                error: function () {
                    $('#alertContainer').html('<div class="alert alert-danger">Error al procesar la postulación.</div>');
                    setTimeout(() => $('#alertContainer').empty(), 5000);
                }
            });
        }
    </script>
}